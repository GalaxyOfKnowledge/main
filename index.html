<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinoy Quiz Trivia Space Invader</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        /* Fullscreen canvas */
        #gameCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: block;
            z-index: 2;
            background-color: rgba(0, 0, 0, 0.9);
        }
        
        /* Screens */
        #menuScreen, #gameOverScreen, #highscoreScreen, #settingsScreen, #winScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 10;
        }
        
        /* Trivia container - NOW VISIBLE! */
        #triviaContainer {
            position: fixed;
            bottom: 20vh;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 700px;
            z-index: 3; /* Above game elements */
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            display: none;
        }
        
        #triviaQuestion {
            font-size: 24px;
            margin-bottom: 20px;
            color: #FFD700;
            text-align: center;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }
        
        #triviaOptions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .triviaOption {
            padding: 15px;
            margin: 5px;
            background-color: #333;
            border: 2px solid #555;
            border-radius: 8px;
            text-align: center;
            flex: 1;
            min-width: 120px;
            font-size: 18px;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .triviaOption.highlighted {
            background-color: #555;
            border-color: #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .triviaOption.selected {
            background: linear-gradient(145deg, #4CAF50, #2E7D32);
            border-color: #2E7D32;
        }
        
        /* Rest of your existing CSS... */
        .title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 40px;
            color: #FFD700;
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }
        
        .menu-button {
            width: 200px;
            height: 50px;
            margin: 10px;
            font-size: 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: linear-gradient(145deg, #333, #555);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
        }
        
        .menu-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
        }
        
        #playButton { background: linear-gradient(145deg, #4CAF50, #2E7D32); }
        #highscoreButton { background: linear-gradient(145deg, #FFC107, #FF8F00); color: black; }
        #settingsButton { background: linear-gradient(145deg, #2196F3, #0D47A1); }
        
        #hud {
            position: fixed;
            top: 10px;
            left: 10px;
            font-size: 18px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid #444;
            display: none;
            z-index: 3;
        }
        
        #powerupHud {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 14px;
            text-align: right;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid #444;
            display: none;
            z-index: 3;
        }
        
        #bossHealthBar {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 20px;
            background-color: #F44336;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #444;
            display: none;
            z-index: 3;
        }
        
        #bossHealth {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 100%;
            transition: width 0.3s;
        }
        
        #shipSelection {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            display: none;
            z-index: 3;
        }
        
        .ship-icon {
            width: 40px;
            height: 40px;
            border: 2px solid #555;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 18px;
            transition: all 0.3s;
        }
        
        .ship-icon.available {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
            animation: pulse 1s infinite;
            background-color: rgba(255, 215, 0, 0.2);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.7); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.9); }
            100% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.7); }
        }
        
        #mobileControls {
            position: fixed;
            bottom: 20px;
            width: 100%;
            display: none;
            justify-content: center;
            z-index: 3;
        }
        
        .mobile-btn {
            width: 80px;
            height: 80px;
            margin: 0 20px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            user-select: none;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
        }
        
        .mobile-btn:active {
            transform: scale(0.95);
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .settings-row {
            display: flex;
            align-items: center;
            margin: 15px 0;
            width: 80%;
            max-width: 400px;
            justify-content: space-between;
        }
        
        .settings-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(145deg, #333, #555);
            color: white;
            font-size: 20px;
            cursor: pointer;
            margin: 0 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }
        
        .settings-value {
            min-width: 60px;
            text-align: center;
        }
        
        #nameInput {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #555;
            background-color: #333;
            color: white;
            margin-bottom: 10px;
            width: 200px;
        }
        
        #nameInputContainer {
            display: none;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        
        #gameOverCover {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            z-index: 5;
        }
        
        #comboCounter {
            position: fixed;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: #FFD700;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.7);
            display: none;
            z-index: 3;
        }
        
        #levelIndicator {
            position: fixed;
            top: 50px;
            right: 20px;
            font-size: 18px;
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            display: none;
            z-index: 3;
        }
        
        @media (max-width: 768px) {
            #mobileControls {
                display: flex;
            }
            
            .title {
                font-size: 36px;
            }
            
            .menu-button {
                width: 160px;
                height: 45px;
                font-size: 18px;
            }
            
            #triviaOptions {
                flex-direction: column;
            }
            
            .triviaOption {
                min-width: 80%;
                margin: 5px auto;
            }
        }
    </style>
</head>
<body>
    <div id="gameOverCover"></div>
    <canvas id="gameCanvas"></canvas>
    
    <div id="hud">
        <div>Lives: <span id="livesDisplay">3</span></div>
        <div>Score: <span id="scoreDisplay">0</span></div>
        <div>Combo: <span id="comboCount">0x</span></div>
    </div>
    
    <div id="powerupHud">
        <div>Power-ups: <span id="powerupStatus">None</span></div>
    </div>
    
    <div id="bossHealthBar">
        <div id="bossHealth"></div>
    </div>
    
    <div id="comboCounter"></div>
    <div id="levelIndicator">Level: <span id="levelNumber">1</span></div>
    
    <div id="triviaContainer">
        <div id="triviaQuestion"></div>
        <div id="triviaOptions"></div>
    </div>
    
    <div id="shipSelection">
        <div class="ship-icon" id="defaultShip" title="Default Ship (X)">X</div>
        <div class="ship-icon" id="bangkaShip" title="Bangka Ship (C)">C</div>
        <div class="ship-icon" id="jeepneyShip" title="Jeepney Ship (V)">V</div>
    </div>
    
    <div id="menuScreen">
        <div class="title">Pinoy Quiz Trivia<br>Space Invader</div>
        <button id="playButton" class="menu-button">Play</button>
        <button id="highscoreButton" class="menu-button">Highscore</button>
        <button id="settingsButton" class="menu-button">Settings</button>
    </div>
    
    <div id="gameOverScreen" style="display: none;">
        <div class="title">Game Over</div>
        <div id="finalScore" style="font-size: 24px; margin-bottom: 20px;"></div>
        <div id="nameInputContainer">
            <div style="margin-bottom: 10px;">Enter your name:</div>
            <input type="text" id="nameInput" maxlength="10">
            <button id="submitScore" class="menu-button" style="background: linear-gradient(145deg, #4CAF50, #2E7D32);">Submit</button>
        </div>
        <button id="continueButton" class="menu-button" style="background: linear-gradient(145deg, #2196F3, #0D47A1);">Continue</button>
    </div>
    
    <div id="winScreen" style="display: none;">
        <div class="title">You Win!</div>
        <div id="winScore" style="font-size: 24px; margin-bottom: 20px;"></div>
        <button id="winContinueButton" class="menu-button" style="background: linear-gradient(145deg, #2196F3, #0D47A1);">Continue</button>
    </div>
    
    <div id="highscoreScreen" style="display: none;">
        <div class="title">High Scores</div>
        <div id="highscoreList" style="margin-bottom: 30px;"></div>
        <button id="backButton" class="menu-button" style="background: linear-gradient(145deg, #2196F3, #0D47A1);">Back</button>
    </div>
    
    <div id="settingsScreen" style="display: none;">
        <div class="title">Settings</div>
        
        <div class="settings-row">
            <div>Music Volume:</div>
            <button id="musicDown" class="settings-button">-</button>
            <div id="musicVolume" class="settings-value">50%</div>
            <button id="musicUp" class="settings-button">+</button>
        </div>
        
        <div class="settings-row">
            <div>Sound Effects:</div>
            <button id="toggleSound" class="settings-button" style="width: 80px;">ON</button>
        </div>
        
        <div class="settings-row">
            <div>Difficulty:</div>
            <button id="changeDifficulty" class="settings-button" style="width: 100px;">NORMAL</button>
        </div>
        
        <button id="settingsBackButton" class="menu-button" style="background: linear-gradient(145deg, #F44336, #B71C1C); margin-top: 30px;">Back to Menu</button>
    </div>
    
    <div id="mobileControls">
        <div class="mobile-btn" id="leftBtn">‚Üê</div>
        <div class="mobile-btn" id="shootBtn">üî´</div>
        <div class="mobile-btn" id="rightBtn">‚Üí</div>
    </div>
    
    <script>
        // Game constants
        const BOSS_SPAWN_SCORE = 1000;
        const LEVEL_UP_SCORE = 500;
        
        // Game states
        const STATE_MENU = 0;
        const STATE_PLAYING = 1;
        const STATE_GAME_OVER = 2;
        const STATE_HIGHSCORE = 3;
        const STATE_SETTINGS = 4;
        const STATE_WIN = 5;
        
        // Initialize canvas
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let CANVAS_WIDTH = window.innerWidth;
        let CANVAS_HEIGHT = window.innerHeight;

        // Set dynamic sizing
        function resizeGame() {
            CANVAS_WIDTH = window.innerWidth;
            CANVAS_HEIGHT = window.innerHeight;
            canvas.width = CANVAS_WIDTH;
            canvas.height = CANVAS_HEIGHT;
            
            if (player) {
                player.x = CANVAS_WIDTH/2 - player.width/2;
                player.y = CANVAS_HEIGHT - player.height - 20;
            }
            
            if (bossActive && boss) {
                boss.x = CANVAS_WIDTH/2 - boss.width/2;
            }
        }

        window.addEventListener('resize', resizeGame);

        // Game variables
        let gameState = STATE_MENU;
        let player = {
            x: CANVAS_WIDTH / 2 - 25,
            y: CANVAS_HEIGHT - 60,
            width: 50,
            height: 30,
            speed: 5,
            lives: 3,
            score: 0,
            powerups: {
                barongShield: false,
                jeepneyBoost: false,
                tiniklingMode: false
            },
            shipSkin: 'default',
            availableShips: {
                default: false,
                bangka: false,
                jeepney: false
            }
        };
        
        let bullets = [];
        let enemies = [];
        let powerups = [];
        let bulletCooldown = 0;
        let enemySpawnRate = 60;
        let enemySpawnTimer = 0;
        let enemySpeed = 1.0;
        let comboCount = 0;
        let comboTimeout = 0;
        let level = 1;
        let lastScoreForLevel = 0;
        
        // Boss variables
        let boss = null;
        let bossActive = false;
        let bossHealth = 0;
        let bossMaxHealth = 0;
        let currentQuestion = null;
        let selectedOption = null;
        let highlightedOption = null;
        
        // High scores
        let highScores = [];
        const MAX_HIGH_SCORES = 10;
        
        // Settings
        let settings = {
            musicVolume: 0.5,
            soundEffects: true,
            difficulty: 'normal' // easy, normal, hard
        };
        
        // Sound effects
        const sounds = {
            shoot: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-laser-weapon-shot-1680.mp3'),
            explosion: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-explosion-impact-1684.mp3'),
            powerup: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3'),
            correct: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3'),
            wrong: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3'),
            bossSpawn: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-monster-roar-1988.mp3'),
            shipChange: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3'),
            win: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3'),
            combo: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-extra-bonus-in-a-video-game-2045.mp3'),
            levelUp: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3')
        };
        
        // Set volume for all sounds
        Object.values(sounds).forEach(sound => {
            sound.volume = settings.soundEffects ? 0.5 : 0;
        });
        
        // Background music
        const backgroundMusic = new Audio('https://assets.mixkit.co/music/preview/mixkit-game-show-suspense-waiting-668.mp3');
        backgroundMusic.volume = settings.musicVolume;
        backgroundMusic.loop = true;
        
        // Trivia questions
        const triviaQuestions = [
            {
                question: "What is the national bird of the Philippines?",
                options: ["Maya", "Philippine Eagle", "Cockatoo", "Kingfisher"],
                answer: 1,
                category: "National Symbols"
            },
            {
                question: "Which Philippine hero is known as the 'Sublime Paralytic'?",
                options: ["Jose Rizal", "Andres Bonifacio", "Apolinario Mabini", "Emilio Aguinaldo"],
                answer: 2,
                category: "History"
            },
            {
                question: "What is the traditional Filipino leaf-wrapped rice cake?",
                options: ["Bibingka", "Puto", "Suman", "Kutsinta"],
                answer: 2,
                category: "Food"
            },
            {
                question: "Which province is known as the 'Rice Granary of the Philippines'?",
                options: ["Bulacan", "Nueva Ecija", "Pampanga", "Tarlac"],
                answer: 1,
                category: "Geography"
            },
            {
                question: "What festival is celebrated in Cebu every third Sunday of January?",
                options: ["Sinulog", "Ati-Atihan", "Dinagyang", "Pahiyas"],
                answer: 0,
                category: "Culture"
            },
            {
                question: "What is the capital of the Philippines?",
                options: ["Cebu", "Davao", "Manila", "Quezon City"],
                answer: 2,
                category: "Geography"
            },
            {
                question: "Which Philippine volcano erupted in 1991?",
                options: ["Mayon", "Taal", "Pinatubo", "Kanlaon"],
                answer: 2,
                category: "Geography"
            },
            {
                question: "What is the traditional Filipino martial art?",
                options: ["Karate", "Taekwondo", "Arnis", "Kung Fu"],
                answer: 2,
                category: "Culture"
            },
            {
                question: "Which Filipino boxer became an eight-division world champion?",
                options: ["Manny Pacquiao", "Nonito Donaire", "Flash Elorde", "Pancho Villa"],
                answer: 0,
                category: "Sports"
            },
            {
                question: "What is the national flower of the Philippines?",
                options: ["Sampaguita", "Rose", "Orchid", "Gumamela"],
                answer: 0,
                category: "National Symbols"
            }
        ];
        
        // Load high scores from localStorage
        function loadHighScores() {
            const savedScores = localStorage.getItem('pinoySpaceInvaderHighScores');
            if (savedScores) {
                highScores = JSON.parse(savedScores);
            } else {
                highScores = [
                    { name: "Jose", score: 10000 },
                    { name: "Maria", score: 8000 },
                    { name: "Juan", score: 6000 },
                    { name: "Ana", score: 4000 },
                    { name: "Pedro", score: 2000 }
                ];
            }
        }
        
        // Save high scores to localStorage
        function saveHighScores() {
            localStorage.setItem('pinoySpaceInvaderHighScores', JSON.stringify(highScores));
        }
        
        // Add a new high score
        function addHighScore(name, score) {
            highScores.push({ name, score });
            highScores.sort((a, b) => b.score - a.score);
            highScores = highScores.slice(0, MAX_HIGH_SCORES);
            saveHighScores();
        }
        
        // Load settings from localStorage
        function loadSettings() {
            const savedSettings = localStorage.getItem('pinoySpaceInvaderSettings');
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
                updateSettingsUI();
            }
        }
        
        // Save settings to localStorage
        function saveSettings() {
            localStorage.setItem('pinoySpaceInvaderSettings', JSON.stringify(settings));
            updateSettingsUI();
        }
        
        // Update settings UI elements
        function updateSettingsUI() {
            document.getElementById('musicVolume').textContent = `${Math.round(settings.musicVolume * 100)}%`;
            document.getElementById('toggleSound').textContent = settings.soundEffects ? 'ON' : 'OFF';
            document.getElementById('changeDifficulty').textContent = settings.difficulty.toUpperCase();
            
            // Update sound volumes
            backgroundMusic.volume = settings.musicVolume;
            Object.values(sounds).forEach(sound => {
                sound.volume = settings.soundEffects ? 0.5 : 0;
            });
            
            // Apply difficulty settings
            switch (settings.difficulty) {
                case 'easy':
                    player.speed = 6;
                    enemySpeed = 0.8;
                    break;
                case 'normal':
                    player.speed = 5;
                    enemySpeed = 1.0;
                    break;
                case 'hard':
                    player.speed = 4;
                    enemySpeed = 1.2;
                    break;
            }
        }
        
        // Initialize game
        function initGame() {
            loadHighScores();
            loadSettings();
            resizeGame();
            
            // Set up event listeners
            document.getElementById('playButton').addEventListener('click', startGame);
            document.getElementById('highscoreButton').addEventListener('click', showHighScores);
            document.getElementById('settingsButton').addEventListener('click', showSettings);
            document.getElementById('continueButton').addEventListener('click', returnToMenu);
            document.getElementById('winContinueButton').addEventListener('click', returnToMenu);
            document.getElementById('backButton').addEventListener('click', returnToMenu);
            document.getElementById('settingsBackButton').addEventListener('click', () => {
                saveSettings();
                returnToMenu();
            });
            document.getElementById('submitScore').addEventListener('click', submitHighScore);
            
            // Settings controls
            document.getElementById('musicDown').addEventListener('click', () => {
                settings.musicVolume = Math.max(0, settings.musicVolume - 0.1);
                updateSettingsUI();
            });
            document.getElementById('musicUp').addEventListener('click', () => {
                settings.musicVolume = Math.min(1, settings.musicVolume + 0.1);
                updateSettingsUI();
            });
            document.getElementById('toggleSound').addEventListener('click', () => {
                settings.soundEffects = !settings.soundEffects;
                updateSettingsUI();
            });
            document.getElementById('changeDifficulty').addEventListener('click', () => {
                const difficulties = ['easy', 'normal', 'hard'];
                const currentIndex = difficulties.indexOf(settings.difficulty);
                settings.difficulty = difficulties[(currentIndex + 1) % difficulties.length];
                updateSettingsUI();
            });
            
            // Mobile controls
            document.getElementById('leftBtn').addEventListener('touchstart', () => {
                keys.ArrowLeft = true;
            });
            document.getElementById('leftBtn').addEventListener('touchend', () => {
                keys.ArrowLeft = false;
            });
            document.getElementById('rightBtn').addEventListener('touchstart', () => {
                keys.ArrowRight = true;
            });
            document.getElementById('rightBtn').addEventListener('touchend', () => {
                keys.ArrowRight = false;
            });
            document.getElementById('shootBtn').addEventListener('touchstart', () => {
                keys[' '] = true;
            });
            document.getElementById('shootBtn').addEventListener('touchend', () => {
                keys[' '] = false;
            });
            
            // Keyboard controls
            window.addEventListener('keydown', (e) => {
                if (e.key in keys) {
                    keys[e.key] = true;
                }
                
                // Ship transformation keys
                if (gameState === STATE_PLAYING) {
                    if (e.key === 'x' && player.availableShips.default) {
                        player.shipSkin = 'default';
                        player.availableShips.default = false;
                        sounds.shipChange.play();
                        updateShipSelectionUI();
                    } else if (e.key === 'c' && player.availableShips.bangka) {
                        player.shipSkin = 'bangka';
                        player.availableShips.bangka = false;
                        sounds.shipChange.play();
                        updateShipSelectionUI();
                    } else if (e.key === 'v' && player.availableShips.jeepney) {
                        player.shipSkin = 'jeepney';
                        player.availableShips.jeepney = false;
                        sounds.shipChange.play();
                        updateShipSelectionUI();
                    } else if (e.key === 'z' && bossActive && highlightedOption !== null) {
                        // Select highlighted trivia option
                        selectBossOption(highlightedOption);
                    }
                }
                
                // In game over screen, allow typing name
                if (gameState === STATE_GAME_OVER && document.getElementById('nameInputContainer').style.display !== 'none') {
                    if (e.key === 'Enter') {
                        submitHighScore();
                    }
                }
            });
            
            window.addEventListener('keyup', (e) => {
                if (e.key in keys) {
                    keys[e.key] = false;
                }
            });
            
            // Start game loop
            requestAnimationFrame(gameLoop);
        }
        
        // Track pressed keys
        const keys = {
            ArrowLeft: false,
            ArrowRight: false,
            ' ': false,
            'z': false
        };
        
        // Update ship selection UI
        function updateShipSelectionUI() {
            document.getElementById('defaultShip').classList.toggle('available', player.availableShips.default);
            document.getElementById('bangkaShip').classList.toggle('available', player.availableShips.bangka);
            document.getElementById('jeepneyShip').classList.toggle('available', player.availableShips.jeepney);
        }
        
        // Update power-up status display
        function updatePowerupStatus() {
            let status = [];
            if (player.powerups.barongShield) status.push("Barong Shield");
            if (player.powerups.jeepneyBoost) status.push("Jeepney Boost");
            if (player.powerups.tiniklingMode) status.push("Tinikling Mode");
            
            document.getElementById('powerupStatus').textContent = 
                status.length > 0 ? status.join(", ") : "None";
        }
        
        // Return to menu from any screen
        function returnToMenu() {
            gameState = STATE_MENU;
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('winScreen').style.display = 'none';
            document.getElementById('highscoreScreen').style.display = 'none';
            document.getElementById('settingsScreen').style.display = 'none';
            document.getElementById('menuScreen').style.display = 'flex';
            document.getElementById('gameOverCover').style.display = 'none';
            
            // Hide all game elements
            document.getElementById('hud').style.display = 'none';
            document.getElementById('powerupHud').style.display = 'none';
            document.getElementById('bossHealthBar').style.display = 'none';
            document.getElementById('triviaContainer').style.display = 'none';
            document.getElementById('shipSelection').style.display = 'none';
            document.getElementById('comboCounter').style.display = 'none';
            document.getElementById('levelIndicator').style.display = 'none';
            
            // Stop background music
            backgroundMusic.pause();
        }
        
        // Submit high score
        function submitHighScore() {
            const nameInput = document.getElementById('nameInput');
            if (nameInput.value.trim() !== '') {
                addHighScore(nameInput.value.trim(), player.score);
                nameInput.value = '';
                document.getElementById('nameInputContainer').style.display = 'none';
                document.getElementById('continueButton').style.display = 'block';
            }
        }
        
        // Start a new game
        function startGame() {
            gameState = STATE_PLAYING;
            document.getElementById('menuScreen').style.display = 'none';
            
            // Reset player
            player = {
                x: CANVAS_WIDTH / 2 - 25,
                y: CANVAS_HEIGHT - 60,
                width: 50,
                height: 30,
                speed: 5,
                lives: 3,
                score: 0,
                powerups: {
                    barongShield: false,
                    jeepneyBoost: false,
                    tiniklingMode: false
                },
                shipSkin: 'default',
                availableShips: {
                    default: false,
                    bangka: false,
                    jeepney: false
                }
            };
            
            // Reset game variables
            bullets = [];
            enemies = [];
            powerups = [];
            bulletCooldown = 0;
            enemySpawnRate = 60;
            enemySpawnTimer = 0;
            boss = null;
            bossActive = false;
            highlightedOption = null;
            comboCount = 0;
            comboTimeout = 0;
            level = 1;
            lastScoreForLevel = 0;
            
            // Show game elements
            document.getElementById('hud').style.display = 'block';
            document.getElementById('powerupHud').style.display = 'block';
            document.getElementById('shipSelection').style.display = 'flex';
            document.getElementById('comboCounter').style.display = 'none';
            document.getElementById('levelIndicator').style.display = 'block';
            document.getElementById('levelNumber').textContent = level;
            
            // Update HUD
            updateHUD();
            updatePowerupStatus();
            updateShipSelectionUI();
            
            // Hide boss elements
            document.getElementById('bossHealthBar').style.display = 'none';
            document.getElementById('triviaContainer').style.display = 'none';
            
            // Start background music
            backgroundMusic.currentTime = 0;
            backgroundMusic.play().catch(e => console.log("Autoplay prevented:", e));
        }
        
        // Show high scores
        function showHighScores() {
            gameState = STATE_HIGHSCORE;
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('highscoreScreen').style.display = 'flex';
            
            // Populate high score list
            const highscoreList = document.getElementById('highscoreList');
            highscoreList.innerHTML = '';
            
            highScores.forEach((score, index) => {
                const scoreElement = document.createElement('div');
                scoreElement.style.fontSize = '20px';
                scoreElement.style.margin = '5px';
                scoreElement.textContent = `${index + 1}. ${score.name} - ${score.score}`;
                highscoreList.appendChild(scoreElement);
            });
        }
        
        // Show settings
        function showSettings() {
            gameState = STATE_SETTINGS;
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('settingsScreen').style.display = 'flex';
        }
        
        // Game over
        function gameOver() {
            gameState = STATE_GAME_OVER;
            document.getElementById('gameOverScreen').style.display = 'flex';
            document.getElementById('finalScore').textContent = `Final Score: ${player.score}`;
            document.getElementById('gameOverCover').style.display = 'block';
            
            // Check if score qualifies for high score
            const qualifiesForHighScore = highScores.length < MAX_HIGH_SCORES || 
                                        player.score > highScores[highScores.length - 1].score;
            
            if (qualifiesForHighScore) {
                document.getElementById('nameInputContainer').style.display = 'flex';
                document.getElementById('continueButton').style.display
